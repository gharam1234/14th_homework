# 프롬프트 301 - Task7: 기기 판매하기 버튼 라우팅

**타입**: Routing
**컴포넌트**: phones-sell-button
**목표**: "기기 판매하기" 버튼 클릭 시 /phones/new 페이지로 라우팅 + 권한 검증

==================================================

## 조건

### Cursor Rules
@01-common.mdc
@04-func.mdc

### 파일 경로
- 훅: `src/components/phones-list/hooks/use-sell-button-routing.hook.ts` (없다면 새로 생성)
- TSX: `src/components/phones-list/index.sell-button.tsx`

### 라우팅 정보
```typescript
// 목적지 페이지
// /phones/new (Next.js 동적 라우팅)
// 라우팅 경로 사용: getPath('PHONE_CREATE')

// 권한 검증
// - 로그인 여부 확인 (향후 확장: 호스트 여부)
```

### 기존 코드 참고
```
src/commons/constants/url.ts // getPath() 함수
```

==================================================

## 핵심요구사항

핵심요구사항) playwright 테스트를 활용하여 TDD 기반으로 구현하고, 테스트에 통과할 때까지 반복할 것.

1) 테스트 제외 라이브러리
   - jest
   - @testing-library/react

2) 테스트 조건
   - timeout은 설정하지 않거나, 500ms 미만으로 설정할 것.
   - 페이지가 완전히 로드된 후 테스트할 것.
       - 페이지 로드 식별 요구사항: 고정식별자 data-testid 대기 방법
       - **중요금지사항** 페이지 로드 식별 금지사항: networkidle 대기 방법
   - Playwright 환경이 없다면 `03-maincamp/playwright.config.ts`를 추가하고 `@playwright/test` 설치 및 실행 스크립트를 구성한다.

---

1) 라우팅 훅 구현
   1-1) useSellButtonRouting() 훅 생성
        - useRouter() 초기화
        - 로그인 상태 확인 (Zustand 스토어 또는 context)
   1-2) handleNavigateToSell() 함수 정의
        - 로그인 여부 체크
        - 미로그인: 알림 메시지 + 로그인 페이지 리다이렉트 (향후)
        - 로그인: /phones/new로 이동

2) 컴포넌트 구현
   2-1) SellButton 컴포넌트 생성
        - Props: className?: string, variant?: "primary" | "secondary"
        - 기본 스타일: 파란색 배경 (#2974e5), 흰색 텍스트
   2-2) 버튼 클릭 핸들러 연결
        - data-testid="sell-button" 속성 추가
        - onClick={() => handleNavigateToSell()}
   2-3) 아이콘 표시 (선택사항)
        - 업로드 아이콘 또는 플러스 아이콘
        - 텍스트: "기기 판매하기"

3) 로그인 권한 검증
   3-1) Zustand 스토어에서 로그인 상태 확인
        - `src/stores/use-access-token.ts`를 우선 활용하고, 필요한 경우 `src/components/phones-list/stores/use-phone-list.store.ts`에 `isLoggedIn` 상태를 확장한다.
   3-2) 미로그인 시 처리
        - alert() 또는 toast 메시지: "로그인이 필요합니다"
        - localStorage에 redirect URL 저장 (선택)
        - 로그인 페이지로 이동 (향후 구현)

4) 테스트 케이스 작성
   4-1) 파일: `src/components/phones-list/tests/sell-button-routing.spec.ts`
   4-2) 테스트 1: 로그인 사용자가 버튼 클릭 시 /phones/new로 이동
        - 조건: localStorage에 user 데이터 설정
        - 실행: sell-button 클릭
        - 검증: URL이 /phones/new로 변경됨
   4-3) 테스트 2: 미로그인 사용자가 버튼 클릭 시 알림 표시
        - 조건: localStorage에 user 데이터 없음
        - 실행: sell-button 클릭
        - 검증: 알림 메시지 표시 또는 URL 변경 없음

5) Props & Types
```typescript
interface SellButtonProps {
  className?: string;
  variant?: "primary" | "secondary";
  onNavigate?: (path: string) => void;  // 테스트용 콜백
}

interface UseSellButtonRoutingReturn {
  handleNavigateToSell: () => Promise<void> | void;
  isLoggedIn: boolean;
}
```

6) 구현 예시 구조
```typescript
// hook
export const useSellButtonRouting = (): UseSellButtonRoutingReturn => {
  const router = useRouter();
  const isLoggedIn = useAuthStore(state => state.user !== null);

  const handleNavigateToSell = async () => {
    if (!isLoggedIn) {
      alert('로그인이 필요합니다');
      return;
    }
    await router.push(getPath('PHONE_CREATE'));
  };

  return { handleNavigateToSell, isLoggedIn };
};

// component
export const SellButton: React.FC<SellButtonProps> = ({ className }) => {
  const { handleNavigateToSell } = useSellButtonRouting();

  return (
    <button
      data-testid="sell-button"
      onClick={handleNavigateToSell}
      className={className}
    >
      기기 판매하기
    </button>
  );
};
```

==================================================
