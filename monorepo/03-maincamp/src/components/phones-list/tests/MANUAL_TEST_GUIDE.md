# 찜(관심상품) 기능 수동 테스트 가이드

## 사전 준비

1. `.env.local` 파일에 Supabase 환경 변수가 설정되어 있어야 합니다:
   ```
   NEXT_PUBLIC_SUPABASE_URL=your-project-url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```

2. 개발 서버를 실행합니다:
   ```bash
   npm run dev
   ```

3. 브라우저에서 `http://localhost:3000/phones` 접속

## 테스트 시나리오

### 1. 로그인 상태에서 찜 기능 테스트

**테스트 단계:**
1. 로그인한 상태로 중고폰 목록 페이지 접속
2. 첫 번째 상품 카드의 하트 버튼(🤍) 클릭
3. 하트가 즉시 채워진 상태(❤️)로 변경되는지 확인 (낙관적 업데이트)
4. 화면 우측 상단에 "관심상품에 추가되었습니다." 토스트 메시지 표시 확인
5. 다시 하트 버튼 클릭
6. 하트가 빈 상태(🤍)로 변경되는지 확인
7. "관심상품에서 제거되었습니다." 토스트 메시지 표시 확인

**확인 사항:**
- [ ] 하트 아이콘이 클릭 즉시 변경됨
- [ ] 토스트 메시지가 표시됨
- [ ] 토스트 메시지가 3초 후 자동으로 사라짐
- [ ] 페이지를 새로고침해도 찜 상태가 유지됨

### 2. 미로그인 상태에서 찜 기능 테스트

**테스트 단계:**
1. 로그아웃 상태로 중고폰 목록 페이지 접속
2. 상품 카드의 하트 버튼 클릭
3. 로그인 페이지(`/`)로 리다이렉트되는지 확인

**확인 사항:**
- [ ] 로그인 페이지로 이동함
- [ ] 찜 상태가 변경되지 않음

### 3. 여러 상품 찜 테스트

**테스트 단계:**
1. 첫 번째 상품 찜
2. 두 번째 상품 찜
3. 세 번째 상품 찜
4. 첫 번째 상품만 찜 해제
5. 나머지 상품들의 찜 상태가 유지되는지 확인

**확인 사항:**
- [ ] 각 상품의 찜 상태가 독립적으로 관리됨
- [ ] 한 상품의 찜 해제가 다른 상품에 영향을 주지 않음

### 4. 접근성 테스트

**테스트 단계:**
1. 개발자 도구를 열고 Elements 탭에서 찜 버튼 확인
2. `aria-label` 속성 확인 (찜 전: "관심상품 저장", 찜 후: "관심상품 제거")
3. `aria-pressed` 속성 확인 (찜 전: "false", 찜 후: "true")
4. 키보드로 Tab 키를 눌러 찜 버튼으로 포커스 이동
5. Enter 키로 찜 버튼 실행 가능 확인

**확인 사항:**
- [ ] aria-label이 올바르게 설정됨
- [ ] aria-pressed가 상태에 따라 변경됨
- [ ] 키보드로 접근 및 실행 가능함

### 5. 에러 처리 테스트

**테스트 단계:**
1. 네트워크 탭을 열어둠
2. 찜 버튼 클릭
3. 네트워크 요청이 실패하도록 인터넷 연결 끊기 (또는 Supabase URL을 잠시 잘못된 값으로 변경)
4. 에러 토스트 메시지 표시 확인
5. 하트 상태가 원래대로 롤백되는지 확인

**확인 사항:**
- [ ] 에러 발생 시 "관심상품 처리에 실패하였습니다. 다시 시도해주세요." 토스트 표시
- [ ] UI 상태가 롤백됨

## Supabase 데이터 확인

### phone_reactions 테이블 확인

1. Supabase 대시보드 > Table Editor > phone_reactions
2. 찜한 상품의 데이터가 올바르게 저장되었는지 확인

**확인할 필드:**
- `phone_id`: 상품 ID
- `user_id`: 사용자 ID  
- `type`: 'favorite'
- `created_at`: 생성 시간
- `deleted_at`: NULL (찜 상태) 또는 시간 (찜 해제 상태)

## 성능 테스트

1. 찜 버튼을 빠르게 여러 번 클릭
2. 중복 요청이 발생하지 않는지 확인 (Network 탭)
3. 로딩 중에는 버튼이 비활성화되는지 확인

**확인 사항:**
- [ ] 로딩 중 버튼이 disabled 상태
- [ ] 중복 요청 방지됨
- [ ] UI가 버벅이지 않음

## 자동 테스트 실행 (환경 설정 후)

```bash
# 전체 테스트 실행
npx playwright test src/components/phones-list/tests/index.favorite.spec.ts

# 특정 브라우저에서만 실행
npx playwright test src/components/phones-list/tests/index.favorite.spec.ts --project=chromium

# UI 모드로 실행 (디버깅)
npx playwright test src/components/phones-list/tests/index.favorite.spec.ts --ui
```

## 트러블슈팅

### 문제: 찜 버튼을 클릭해도 하트가 변경되지 않음

**해결 방법:**
1. 브라우저 콘솔에서 에러 메시지 확인
2. Supabase 환경 변수가 올바르게 설정되었는지 확인
3. 로그인 상태인지 확인
4. phone_reactions 테이블이 존재하는지 확인

### 문제: 토스트 메시지가 표시되지 않음

**해결 방법:**
1. CSS가 올바르게 로드되었는지 확인
2. z-index 충돌이 없는지 확인
3. 브라우저 개발자 도구에서 토스트 엘리먼트가 렌더링되는지 확인

### 문제: 페이지를 새로고침하면 찜 상태가 초기화됨

**해결 방법:**
1. useFavorite 훅의 useEffect가 실행되는지 확인
2. Supabase에서 데이터를 올바르게 조회하는지 확인
3. Zustand 스토어가 올바르게 업데이트되는지 확인

